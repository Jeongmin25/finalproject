<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="job.data.resume.ResumeMapper">
	<select id="getTotalCount" resultType="int">
		select count(*) from resume
	</select>
	<insert id="insertResume" parameterType="resume">
		insert into resume (intro,skill,link,nowdate) values (#{intro},#{skill},#{link},now())
	</insert>
	<select id="getInsertNum" resultType="int">
		select LAST_INSERT_ID()
	</select>
	<insert id="insertAward" parameterType="award">
		insert into award (activity,detail,endday,startday,num_r) values (#{activity, jdbcType=VARCHAR},#{detail, jdbcType=VARCHAR},#{a_endday, jdbcType=VARCHAR},#{a_startday, jdbcType=VARCHAR},#{num_r})
	</insert>
	<insert id="insertCarer" parameterType="carer">
		insert into carer (company,department,endday,startday,num_r) values (#{company, jdbcType=VARCHAR},#{department, jdbcType=VARCHAR},#{c_endday, jdbcType=VARCHAR},#{c_startday, jdbcType=VARCHAR},#{num_r})
	</insert>
	<insert id="insertEducation" parameterType="education">
		insert into education (school,major,endday,startday,num_r) values (#{school, jdbcType=VARCHAR},#{major, jdbcType=VARCHAR},#{e_endday, jdbcType=VARCHAR},#{e_startday, jdbcType=VARCHAR},#{num_r})
	</insert>
	<insert id="insertFore" parameterType="fore">
		insert into fore (lang,level,num_r) values (#{lang, jdbcType=VARCHAR},#{level, jdbcType=VARCHAR},#{num_r})
	</insert>
	<select id="getDataOfResume" resultType="resume">
		select * from resume order by num_r desc
	</select>
	<delete id="delresume" parameterType="String">
			set foreign_key_checks=0;
			delete from resume where num_r=#{num_r};
			set foreign_key_checks = 1;
	</delete>
	
	<!-- 이력서 출력을 위한 resultMap 선언 -->
	<resultMap type="resume" id="resume-selectmap">
		<id property="num_r" column="NUM_R"/>
		<result property="skill" column="SKILL"/>
		<collection property="carer" ofType="carer" column="num_r=NUM_R" javaType="list" select="getCarerList"/>
		<collection property="award" ofType="award" column="num_r=NUM_R" javaType="list" select="getAWwardList"/>
		<collection property="education" ofType="education" column="num_r=NUM_R" javaType="list" select="getEducationList"/>
		<collection property="fore" ofType="fore" column="num_r=NUM_R" javaType="list" select="getForeList"/>
	</resultMap>
	
	
	<select id="getResumeOneData" resultMap="resume-selectmap">
		select * from resume where num_r=#{num_r}
	</select>
	<select id="getCarerList" resultType="carer">
		select startday as c_startday, endday as c_endday,company,department from carer where num_r=#{num_r}
	</select>
	<select id="getAWwardList" resultType="award">
		select startday as a_startday,activity,detail, endday as a_endday from award where num_r=#{num_r}
	</select>
	<select id="getEducationList" resultType="education">
		select startday as e_startday, endday as e_endday,school,major from education where num_r=#{num_r}
	</select>
	<select id="getForeList" resultType="fore">
		select * from fore where num_r=#{num_r}
	</select>
	
	<update id="updateResume" parameterType="resume">
		update resume set intro=#{intro},skill=#{skill},link=#{link} where num_r=#{num_r}
	</update>
	<update id="updateAward" parameterType="award">
		update award set activity=#{activity},detail=#{detail},startday=#{a_startday}, endday=#{a_endday} where num_r=#{num_r}
	</update>
	<update id="updateCarer" parameterType="carer">
		update carer set company=#{company},department=#{department},startday=#{c_startday}, endday=#{c_endday} where num_r=#{num_r}
	</update>
	<update id="updateEducation" parameterType="education">
		update education set school=#{school},major=#{major},startday=#{e_startday}, endday=#{e_endday} where num_r=#{num_r}
	</update>
	<update id="updateFore" parameterType="fore">
		update fore set lang=#{lang},level=#{level} where num_r=#{num_r}
	</update>
	
	<delete id="delAward" parameterType="int">
		set foreign_key_checks=0;
		delete from award where num_r=#{num_r};
		set foreign_key_checks = 1;
	</delete>
	<delete id="delCarer" parameterType="int">
		set foreign_key_checks=0;
		delete from carer where num_r=#{num_r};
		set foreign_key_checks = 1;
	</delete>
	<delete id="delEducation" parameterType="int">
		set foreign_key_checks=0;
		delete from education where num_r=#{num_r};
		set foreign_key_checks = 1;
	</delete>
	<delete id="delFore" parameterType="int">
		set foreign_key_checks=0;
		delete from fore where num_r=#{num_r};
		set foreign_key_checks = 1;
	</delete>
</mapper>