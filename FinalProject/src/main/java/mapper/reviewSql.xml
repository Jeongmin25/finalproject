<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="job.data.review.reviewMapper">
	<select id="getTotalCount" resultType="int">
		select count(*) from review
	</select>

	
	<!-- review테이블 데이터 추가 -->
	<insert id="insertReview" parameterType="review">
		insert into review (email,empname,prenow,job_group,good,bad,rating,
		cul,imp,env,sal,ceo,writeday) values(#{email},#{empname},#{prenow},#{job_group},#{good}
		,#{bad},#{rating},#{cul},#{imp},#{env},#{sal},#{ceo},now())
	</insert>
	
	<!-- review테이블 전체 출력 -->
	<select id="getReviewData" resultType="review" parameterType="String">
		select * from review
	</select>
	
	<!--  empname에 해당하는 데이터 출력-->
	<select id="getReviewDataOfEmp" resultType="review" parameterType="String">
		select * from review where empname=#{empname} order by writeday desc
	</select>
	
	<!-- 기업명 조회 -->
	<select id="selectEmpname" resultType="review" parameterType="HashMap">
		select DISTINCT empname from review limit #{start},#{perpage}
	</select>
	
	<!-- 기업명 개수(중복제외) -->
	<select id="selectEmpnameCount" resultType="int">
		select count(DISTINCT empname) from review
	</select>

	<!--  기업 총 평가 평균-->
	<select id="avgRating" resultType="float" parameterType="String">
		select round(avg(rating),1) from review where empname=#{empname};
	</select>
	
	<!--  사내문화 평균-->
	<select id="avgCul" resultType="float" parameterType="String">
		select round(avg(cul),1) from review where empname=#{empname};
	</select>
	
	<!--  자기개발 평균-->
	<select id="avgImp" resultType="float" parameterType="String">
		select round(avg(imp),1) from review where empname=#{empname};
	</select>
	
	<!--  근무환경 평균-->
	<select id="avgEnv" resultType="float" parameterType="String">
		select round(avg(env),1) from review where empname=#{empname};
	</select>
	
	<!--  급여 및 복지 평균-->
	<select id="avgSal" resultType="float" parameterType="String">
		select round(avg(sal),1) from review where empname=#{empname};
	</select>
	
	<!--  경영진 평균-->
	<select id="avgCeo" resultType="float" parameterType="String">
		select round(avg(ceo),1) from review where empname=#{empname};
	</select>
	
	<!-- 기업명 별 리뷰개수 -->
	<select id="review0fEmp" resultType="int" parameterType="String">
		select count(*) from review where empname=#{empname}
	</select>
	
	<!-- num에 해당하는 조회수 증가 -->
	<insert id="insertlikes" parameterType="int">
		insert into review (count) values (count+1) WHERE NOT EXISTS 
		(SELECT num FROM likes WHERE num =#{num})

	</insert>
	
	<!-- num에 해당하는 데이터, 좋아요 수 select-->
	<select id="dataOfnumLikes" resultType="review" parameterType="int">
		select * from review join likes on(review.#{num}=likes.#{num})
	</select>
	
	<!-- 기업명 검색 -->
	<select id="searchEmpname" resultType="review" parameterType="String">
		SELECT * FROM review WHERE empname LIKE '%'#{word}'%'
	</select>
		
</mapper>