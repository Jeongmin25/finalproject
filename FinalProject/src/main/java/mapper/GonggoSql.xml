<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="job.data.gonggo.CompanyMapper">
	<select id="getAlldatas" resultType="company" >
		select * from company order by deadline desc 
	</select>
	
	<resultMap type="company" id="copany-resultmap">
		<id property="num" column="NUM"/>
		<collection property="category" ofType="category" column="num=NUM" javaType="list" select="getCtgData"/>
	</resultMap>
	
	<select id="getData" parameterType="String" resultType="company">
		select * from company where num=#{num}
	</select>
	<select id="getCtgData" parameterType="String" resultType="category">
		select ctg as ,tag from company where num=#{num}
	</select>
	<insert id="insertGonggo" parameterType="company">
		insert into company (empname,job,jobgroup,empcontent,empimg,deadline,writeday) 
		values (#{empname},#{job},#{jobgroup},#{empcontent},#{empimg},STR_TO_DATE(#{deadline},'%Y-%m-%d'),now())
	</insert>
	<insert id="insertCategory" parameterType="category">
		insert into category (ctg,tag,num) 
		values (#{ctg},#{tag},#{num})
	</insert>
	<select id="getInsertNum" resultType="int">
		select LAST_INSERT_ID()
	</select>
	<delete id="deleteGonggo" parameterType="String">
		delete from company where num=#{num}
	</delete>
	<delete id="deleteCategory" parameterType="String">
		delete from category where num=#{num}
	</delete>
	
	<update id="updateGonggo" parameterType="company">
		update company set job=#{job},jobgroup=#{jobgroup},empcontent=#{empcontent},empimg=#{empimg},deadline=STR_TO_DATE(#{deadline},'%Y-%m-%d') where num=#{num}
	</update>
	
	<!-- bookmark -->
	<select id="searchNum" parameterType="Hashmap" resultType="int">
		select count(*) from bookmark where id=#{id} and num=#{num}
	</select>
	<insert id="insertBookmark" parameterType="Hashmap">
		insert into bookmark (id,num) values (#{id},#{num})
	</insert>
	<delete id="deleteBookmark" parameterType="Hashmap">
		delete from bookmark where id=#{id} and num=#{num}
	</delete>
</mapper>
