<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="job.data.gonggo.CompanyMapper">
	<select id="getAlldatas" resultType="company" >
		select * from company order by deadline desc 
	</select>
	
	<resultMap type="company" id="company-selectmap">
		<id property="num" column="NUM"/>
		<collection property="category" ofType="category" column="num=NUM" javaType="list" select="getCtgData"/>
	</resultMap>
	
	<select id="getData" resultMap="company-selectmap">
		select * from company where num=#{num}
	</select>
	<select id="getCtgData" resultType="category">
		select * from category where num=#{num}
	</select>
	<insert id="insertGonggo" parameterType="company">
		insert into company (empname,job,jobgroup,empcontent,empimg,deadline,writeday) 
		values (#{empname},#{job},#{jobgroup},#{empcontent},#{empimg},STR_TO_DATE(#{deadline},'%Y-%m-%d'),now())
	</insert>
	<insert id="insertCategory" parameterType="category">
		insert into category (ctg,tag,num) 
		values (#{ctg},#{tag},#{num})
	</insert>
	<select id="getInsertNum" resultType="int">
		select LAST_INSERT_ID()
	</select>
	<delete id="deleteGonggo" parameterType="String">
			set foreign_key_checks=0;
			delete from company where num=#{num};
			set foreign_key_checks = 1;
	</delete>
	<delete id="deleteCategory" parameterType="String">
		set foreign_key_checks=0;
		delete from category where num=#{num};
		set foreign_key_checks = 1;
	</delete>
	
	<update id="updateGonggo" parameterType="company">
		update company set job=#{job},jobgroup=#{jobgroup},empcontent=#{empcontent},empimg=#{empimg},deadline=STR_TO_DATE(#{deadline},'%Y-%m-%d') where num=#{num}
	</update>
</mapper>
